$(function(){let e=window.location.pathname.split("/")[2];const{log:t}=console;if(body=$("body"),e){let l=$("<ul>").attr("id","chatbox").addClass("chatbox"),o=$("<ul>").attr("id","cloned").addClass("chatbox"),r=$("<li>").attr("id","clone"),d=io("/chat-box"),p=0,i=null,c=null,h=null;function n(e,t){$.ajax({type:"HEAD",url:e,success:(e,n,a)=>{t&&t({contentType:a.getResponseHeader("content-type")})}})}function a(e,t,n){if(t){let n=[];for(let a in t){let s=`<img src="https://static-cdn.jtvnw.net/emoticons/v1/${a}/1.0" />`,l=t[a][0].split("-"),o=parseInt(l[0]),r=parseInt(l[1]),d=e.substring(o,r+1);n.push({find:d,replace:s})}n.sort((e,t)=>t.find.length-e.find.length);for(let t in n)e=e.replace(new RegExp(`(|:\\W)${n[t].find}(|:\\W)`,"g"),n[t].replace)}n&&n(e)}function s(e,t,a,l){if(t&&t.length){let o=t.shift();n(0==o.indexOf("http")?o:`//${o}`,n=>{e=0==n.contentType.indexOf("image")&&a?e.replace(o,`<img src="${o}" />`):e.replace(o,`<span class="link">${o}</span>`),s(e,t,a,l)})}else l&&"function"==typeof l&&l(e)}body.append(l).append(o),o.append(r),d.on("connect",()=>{t("[Connected to server]"),d.emit("handshake",{channel:e})}),$.ajax({url:"https://badges.twitch.tv/v1/badges/global/display",type:"GET",success:e=>{h=e.badge_sets},error:e=>{throw e}}),d.on("clear",e=>{t("[Chat Cleared]"),p=0,l.empty(),c=null,i=null}),d.on("message",e=>{const{context:n,message:o,isSuperUser:d}=e,{color:u,emotes:f,username:m}=n;t(`%c${n["display-name"]}`+`%c ${o}`,"color: "+(u||"#ab187f")+"; font-weight:bold;","color:#000");let g=$("<span>").addClass("content").text(m),b=/(^|\s)(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/g,w=o.match(b);s(o,w,d,e=>{a(e,f,e=>{if(g.html(e),m==i&&c&&(r.html(c.html()),r.append(g),r.height()<=.75*$(window).height()))return void c.append(g);let t=$("<li>"),a=$("<span>");if(t.addClass("message"),p++%2==0&&t.addClass("bg"),t.attr("data-from",n.username),a.addClass("name").css("color",n.color),n.badges){let e=$("<span>").addClass("badges");for(let t in n.badges)if(h&&h.hasOwnProperty(t)){let n=h[t].versions,a=[];for(let e in n)a.push(n[e].image_url_2x);let s=$("<img />");s.attr("src",a.pop()),e.append(s)}a.append(e)}a.append(n["display-name"]),t.append(a).append(g),l.append(t),i=n.username,c=t})})}),d.on("timeout",e=>{t(`[User ${e.user} Timed Out for ${e.length}]`),$(l).find(`li[data-from="${e.user}"]`).remove(),i===e.user&&(i=null,c=null)}),d.on("ban",e=>{t(`[User ${e.user} Banned]`),$(l).find(`li[data-from="${e.user}"]`).remove(),i===e.user&&(i=null,c=null)})}else body.append('<div id="error"><h2>Please specify a channel in the URL, for example: <pre>https://[serveraddress]/[channel]/chat-box</pre></h2></div>')});