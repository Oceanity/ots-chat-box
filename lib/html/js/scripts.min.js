"use strict";$(function(){let e=window.location.pathname.split("/")[2];const n=$("body");if(e){const a=$("<ul>",{id:"chatbox",class:"chatbox"}),i=$("<ul>",{id:"cloned",class:"chatbox"}),r=$("<li>",{id:"clone"}),c=io("/chat-box");let p=!1,d=null,u=null,h=null,f=!0,g=!1,m=!0;function t(e){return e.hasOwnProperty("msg-id")&&"highlighted-message"===e["msg-id"]}function o(e,n,t=5e3){let o,s=!1;const l=new Image;l.onerror=l.onabort=function(){s||(clearTimeout(o),n(!1))},l.onload=function(){s||(clearTimeout(o),n(!0))},l.src=e,o=setTimeout(function(){s=!0,n(null)},t)}function s(e,n,t){let o=[];for(let t in n){const s=$("<span>",{class:"emote"}),l=$("<img>",{src:`https://static-cdn.jtvnw.net/emoticons/v1/${t}/4.0`}),a=n[t][0].split("-"),i=parseInt(a[0]),r=parseInt(a[1])+1,c=e.substring(i,r);s.append(l),o.push({find:c,replace:s[0].outerHTML})}e=e.split(" ").map(e=>{for(let n of o)if(e===n.find)return n.replace;if(e.trim().length)return e}).join(" "),t&&t(e)}function l(e,n,t,s){let l=!1;if(n.length){function a(e,n){if(n.length){let s=n.shift();console.log(s),o(s.url,o=>{if(o&&!l&&t){const t=$("<img>",{src:s.url});e[s.index]=t[0].outerHTML,l=!0,a(e,n)}else{const t=$("<span>",{class:"link",text:s.url});e[s.index]=t[0].outerHTML,a(e,n)}})}else s&&"function"==typeof s&&s(e.join(" "))}a(e,n)}else s&&"function"==typeof s&&s(e.join(" "))}n.append(a).append(i),i.append(r),c.on("connect",()=>{console.log("%c[Connected to server]","color: #9147FF; font-weight:bold"),c.emit("handshake",{channel:e})}),c.on("config",e=>{f=e.mergeMessages,g=e.inlineMessages,m=e.showBadges}),$.ajax({url:"https://badges.twitch.tv/v1/badges/global/display",type:"GET",success:e=>{h=e.badge_sets},error:e=>{throw e}}),c.on("clear",e=>{console.log("%c[Chat Cleared]","color: #9147FF; font-weight:bold"),p=!1,a.empty(),u=null,d=null}),c.on("message",e=>{const{context:n,message:o,self:i,isSuperUser:c}=e,{emotes:b,username:w}=n,x=n.color||"#9147FF",v=t(n);console.log(`%c${n["display-name"]}%c: ${o}`,"color: "+(x||"#ab187f")+"; font-weight:bold;","color:#aaa");const y=$("<span>",{class:"content",text:w}),T=/(?:^|\s)(?:https?\:\/\/)?(\w+\.)?[\w.?&=-]+\.\w+(?:\/[\w.?&=\/:.+\-%_]*)*(?:\s|$)/gi;let j=o.split(" "),F=[];for(let e in j){let n=j[e].match(T);n&&F.push({index:e,url:n.shift()})}console.log(F),l(j,F,c,e=>{s(e,b,e=>{let t=!1;if(y.html(e),f&&w==d&&u&&!v&&(r.html(u.html()),g?r.find(".content").append(e):r.append(y),r.height()<=.75*$(window).height()))return void u.html(r.html());p=!p;const o=$("<li>",{class:["message",g?"inline":null,p?"bg":null].join(" "),css:{"--theme-color":x},"data-from":n.username}),s=$("<span>",{class:"name"});if(v&&(t=!0,o.addClass("highlighted")),m&&n.badges){let e=$("<span>",{class:"badges"});for(let t in n.badges)if(h&&h.hasOwnProperty(t)){let n=h[t].versions,o=[];for(let e in n)o.push(n[e].image_url_2x);const s=$("<img />",{src:o.pop()});e.append(s)}s.append(e)}s.append(n["display-name"]),o.append(s).append(y),a.append(o),d=n.username,u=t?null:o})})}),c.on("timeout",e=>{console.log(`[User ${e.user} Timed Out for ${e.length}]`),$(a).find(`li[data-from="${e.user}"]`).remove(),d===e.user&&(d=null,u=null)}),c.on("ban",e=>{console.log(`[User ${e.user} Banned]`),$(a).find(`li[data-from="${e.user}"]`).remove(),d===e.user&&(d=null,u=null)})}else n.append('<div id="error"><h2>Please specify a channel in the URL, for example: <pre>https://[serveraddress]/[channel]/chat-box</pre></h2></div>')});