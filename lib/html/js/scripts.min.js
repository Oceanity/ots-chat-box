"use strict";$(function(){let e=window.location.pathname.split("/")[2];const n=$("body"),t=[{regex:/trans\s+rights/gi,class:"trans stroke name-stroke"}];if(e){const i=$("<ul>",{id:"chatbox",class:"chatbox"}),r=$("<ul>",{id:"cloned",class:"chatbox"}),c=$("<li>",{id:"clone"}),d=io("/chat-box");let p=!1,u=null,h=null,f=null,g=!0,m=!1,b=!0;function s(e){return e.hasOwnProperty("msg-id")&&"highlighted-message"===e["msg-id"]}function o(e,n,t=5e3){let s,o=!1;const l=new Image;l.onerror=l.onabort=function(){o||(clearTimeout(s),n(!1))},l.onload=function(){o||(clearTimeout(s),n(!0))},l.src=e,s=setTimeout(function(){o=!0,n(null)},t)}function l(e,n,t){let s=[];for(let t in n){const o=$("<span>",{class:"emote"}),l=$("<img>",{src:`https://static-cdn.jtvnw.net/emoticons/v1/${t}/4.0`}),a=n[t][0].split("-"),i=parseInt(a[0]),r=parseInt(a[1])+1,c=e.substring(i,r);o.append(l),s.push({find:c,replace:o[0].outerHTML})}e=e.split(" ").map(e=>{for(let n of s)if(e===n.find)return n.replace;if(e.trim().length)return e}).join(" "),t&&t(e)}function a(e,n,t,s){let l=!1;if(n.length){function a(e,n){if(n.length){let s=n.shift();o(s.url,o=>{if(o&&!l&&t){const t=$("<img>",{src:s.url});e[s.index]=t[0].outerHTML,l=!0,a(e,n)}else{const t=$("<span>",{class:"link",text:s.url});e[s.index]=t[0].outerHTML,a(e,n)}})}else s&&"function"==typeof s&&s(e.join(" "))}a(e,n)}else s&&"function"==typeof s&&s(e.join(" "))}n.append(i).append(r),r.append(c),d.on("connect",()=>{console.log("%c[Connected to server]","color: #9147FF; font-weight:bold"),d.emit("handshake",{channel:e})}),d.on("config",e=>{g=e.mergeMessages,m=e.inlineMessages,b=e.showBadges}),$.ajax({url:"https://badges.twitch.tv/v1/badges/global/display",type:"GET",success:e=>{f=e.badge_sets},error:e=>{throw e}}),d.on("clear",e=>{console.log("%c[Chat Cleared]","color: #9147FF; font-weight:bold"),p=!1,i.empty(),h=null,u=null}),d.on("message",e=>{const{context:n,message:o,self:r,isSuperUser:d}=e,{emotes:w,username:x}=n,v=n.color||"#9147FF",y=s(n);console.log(`%c${n["display-name"]}%c: ${o}`,"color: "+(v||"#ab187f")+"; font-weight:bold;","color:#aaa");const T=$("<span>",{class:"content",text:x}),j=/(?:^|\s)(?:https?\:\/\/)?(\w+\.)?[\w.?&=-]+\.\w+(?:\/[\w.?&=\/:.+\-%_]*)*(?:\s|$)/gi;let F=o.split(" "),k=[];for(let e in F){let n=F[e].match(j);n&&k.push({index:e,url:n.shift()})}a(F,k,d,e=>{l(e,w,e=>{let s=!1;if(T.html(e),g&&x==u&&h&&!y&&(c.html(h.html()),m?c.find(".content").append(e):c.append(T),c.height()<=.75*$(window).height()))return void h.html(c.html());p=!p;const o=$("<li>",{class:["message",m?"inline":null,p?"bg":null].join(" "),css:{"--theme-color":v},"data-from":n.username}),l=$("<span>",{class:"name"});for(let n of t)if(e.match(n.regex)){o.addClass(n.class);break}if(y&&(s=!0,o.addClass("highlighted")),b&&n.badges){let e=$("<span>",{class:"badges"});for(let t in n.badges)if(f&&f.hasOwnProperty(t)){let n=f[t].versions,s=[];for(let e in n)s.push(n[e].image_url_2x);const o=$("<img />",{src:s.pop()});e.append(o)}l.append(e)}l.append(n["display-name"]),o.append(l).append(T),i.append(o),u=n.username,h=s?null:o})})}),d.on("timeout",e=>{console.log(`%c[User ${e.user} Timed Out for ${e.length}]`,"font-weight: bold; color: #d19b4b;"),$(i).find(`li[data-from="${e.user}"]`).remove(),u===e.user&&(u=null,h=null)}),d.on("ban",e=>{console.log(`%c[User ${e.user} Banned]`,"font-weight: bold; color: #e54947;"),$(i).find(`li[data-from="${e.user}"]`).remove(),u===e.user&&(u=null,h=null)})}else n.append('<div id="error"><h2>Please specify a channel in the URL, for example: <pre>https://[serveraddress]/[channel]/chat-box</pre></h2></div>')});