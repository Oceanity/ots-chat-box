"use strict";$(function(){let e=window.location.pathname.split("/")[2];const n=$("body");if(e){const o=$("<ul>").attr("id","chatbox").addClass("chatbox"),i=$("<ul>").attr("id","cloned").addClass("chatbox"),r=$("<li>").attr("id","clone"),c=io("/chat-box");let p=!1,d=null,h=null,u=null,g=!0,m=!1,f=!0;function t(e){return e.hasOwnProperty("msg-id")&&"highlighted-message"===e["msg-id"]}function s(e,n){$.ajax({type:"HEAD",url:e,success:(e,t,s)=>{n&&n({contentType:s.getResponseHeader("content-type")})}})}function l(e,n,t){let s=[];for(let t in n){let l=`<img src="https://static-cdn.jtvnw.net/emoticons/v1/${t}/1.0" />`,a=n[t][0].split("-"),o=parseInt(a[0]),i=parseInt(a[1])+1,r=e.substring(o,i);s.push({find:r,replace:l})}e=e.split(" "),e=e.map(e=>{for(let n of s)if(e===n.find)return n.replace;if(e.trim().length)return e}).join(" "),t&&t(e)}function a(e,n,t,l){if(n&&n.length){let o=n.shift();s(0==o.indexOf("http")?o:`//${o}`,s=>{e=0===s.contentType.indexOf("image")&&t?e.replace(o,`<img src="${o}" />`):e.replace(o,`<span class="link">${o}</span>`),a(e,n,t,l)})}else l&&"function"==typeof l&&l(e)}n.append(o).append(i),i.append(r),c.on("connect",()=>{console.log("%c[Connected to server]","color: #9147FF; font-weight:bold"),c.emit("handshake",{channel:e})}),c.on("config",e=>{g=e.mergeMessages,m=e.inlineMessages,f=e.showBadges}),$.ajax({url:"https://badges.twitch.tv/v1/badges/global/display",type:"GET",success:e=>{u=e.badge_sets},error:e=>{throw e}}),c.on("clear",e=>{console.log("%c[Chat Cleared]","color: #9147FF; font-weight:bold"),p=!1,o.empty(),h=null,d=null}),c.on("message",e=>{const{context:n,message:s,self:i,isSuperUser:c}=e,{emotes:b,username:w}=n,y=n.color||"#9147FF",x=t(n);console.log(`%c${n["display-name"]}%c: ${s}`,"color: "+(y||"#ab187f")+"; font-weight:bold;","color:#aaa");const v=$("<span>",{class:"content",text:w});let C=/(^|\s)(http:\/\/www\.|https:\/\/www\.|http:\/\/|https:\/\/)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/g,F=s.match(C);a(s,F,c,e=>{l(e,b,e=>{let t=!1;if(v.html(e),g&&w==d&&h&&!x&&(r.html(h.html()),m?r.find(".content").append(e):r.append(v),r.height()<=.75*$(window).height()))return void h.html(r.html());p=!p;const s=$("<li>",{class:["message",m?"inline":null,p?"bg":null].join(" "),css:{"--theme-color":y},"data-from":n.username}),l=$("<span>",{class:"name"});if(x&&(t=!0,s.addClass("highlighted")),f&&n.badges){let e=$("<span>",{class:"badges"});for(let t in n.badges)if(u&&u.hasOwnProperty(t)){let n=u[t].versions,s=[];for(let e in n)s.push(n[e].image_url_2x);const l=$("<img />",{src:s.pop()});e.append(l)}l.append(e)}l.append(n["display-name"]),s.append(l).append(v),o.append(s),d=n.username,h=t?null:s})})}),c.on("timeout",e=>{console.log(`[User ${e.user} Timed Out for ${e.length}]`),$(o).find(`li[data-from="${e.user}"]`).remove(),d===e.user&&(d=null,h=null)}),c.on("ban",e=>{console.log(`[User ${e.user} Banned]`),$(o).find(`li[data-from="${e.user}"]`).remove(),d===e.user&&(d=null,h=null)})}else n.append('<div id="error"><h2>Please specify a channel in the URL, for example: <pre>https://[serveraddress]/[channel]/chat-box</pre></h2></div>')});