"use strict";$(function(){let e=window.location.pathname.split("/")[2];const n=$("body");if(e){const i=$("<ul>",{id:"chatbox",class:"chatbox"}),a=$("<ul>",{id:"cloned",class:"chatbox"}),r=$("<li>",{id:"clone"}),c=io("/chat-box");let d=!1,p=null,u=null,h=null,f=!0,g=!1,m=!0;function t(e){return e.hasOwnProperty("msg-id")&&"highlighted-message"===e["msg-id"]}function l(e,n,t=5e3){let l,o=!1;const s=new Image;s.onerror=s.onabort=function(){o||(clearTimeout(l),n(!1))},s.onload=function(){o||(clearTimeout(l),n(!0))},s.src=e,l=setTimeout(function(){o=!0,n(null)},t)}function o(e,n,t){let l=[];for(let t in n){let o=`<img src="https://static-cdn.jtvnw.net/emoticons/v1/${t}/1.0" />`,s=n[t][0].split("-"),i=parseInt(s[0]),a=parseInt(s[1])+1,r=e.substring(i,a);l.push({find:r,replace:o})}e=e.split(" ").map(e=>{for(let n of l)if(e===n.find)return n.replace;if(e.trim().length)return e}).join(" "),t&&t(e)}function s(e,n,t,o){let s=!1;if(n.length){function i(e,n){if(n.length){let o=n.shift();console.log(o),l(o.url,l=>{if(l&&!s&&t){const t=$("<img>",{src:o.url});e[o.index]=t[0].outerHTML,s=!0,i(e,n)}else{const t=$("<span>",{class:"link",text:o.url});e[o.index]=t[0].outerHTML,i(e,n)}})}else o&&"function"==typeof o&&o(e.join(" "))}i(e,n)}else o&&"function"==typeof o&&o(e.join(" "))}n.append(i).append(a),a.append(r),c.on("connect",()=>{console.log("%c[Connected to server]","color: #9147FF; font-weight:bold"),c.emit("handshake",{channel:e})}),c.on("config",e=>{f=e.mergeMessages,g=e.inlineMessages,m=e.showBadges}),$.ajax({url:"https://badges.twitch.tv/v1/badges/global/display",type:"GET",success:e=>{h=e.badge_sets},error:e=>{throw e}}),c.on("clear",e=>{console.log("%c[Chat Cleared]","color: #9147FF; font-weight:bold"),d=!1,i.empty(),u=null,p=null}),c.on("message",e=>{const{context:n,message:l,self:a,isSuperUser:c}=e,{emotes:b,username:w}=n,x=n.color||"#9147FF",v=t(n);console.log(`%c${n["display-name"]}%c: ${l}`,"color: "+(x||"#ab187f")+"; font-weight:bold;","color:#aaa");const y=$("<span>",{class:"content",text:w}),T=/(?:^|\s)(?:https?\:\/\/)?(\w+\.)?[\w.?&=-]+\.\w+(?:\/[\w.?&=\/:.+\-%_]*)*(?:\s|$)/gi;let j=l.split(" "),F=[];for(let e in j){let n=j[e].match(T);n&&F.push({index:e,url:n.shift()})}console.log(F),s(j,F,c,e=>{o(e,b,e=>{let t=!1;if(y.html(e),f&&w==p&&u&&!v&&(r.html(u.html()),g?r.find(".content").append(e):r.append(y),r.height()<=.75*$(window).height()))return void u.html(r.html());d=!d;const l=$("<li>",{class:["message",g?"inline":null,d?"bg":null].join(" "),css:{"--theme-color":x},"data-from":n.username}),o=$("<span>",{class:"name"});if(v&&(t=!0,l.addClass("highlighted")),m&&n.badges){let e=$("<span>",{class:"badges"});for(let t in n.badges)if(h&&h.hasOwnProperty(t)){let n=h[t].versions,l=[];for(let e in n)l.push(n[e].image_url_2x);const o=$("<img />",{src:l.pop()});e.append(o)}o.append(e)}o.append(n["display-name"]),l.append(o).append(y),i.append(l),p=n.username,u=t?null:l})})}),c.on("timeout",e=>{console.log(`[User ${e.user} Timed Out for ${e.length}]`),$(i).find(`li[data-from="${e.user}"]`).remove(),p===e.user&&(p=null,u=null)}),c.on("ban",e=>{console.log(`[User ${e.user} Banned]`),$(i).find(`li[data-from="${e.user}"]`).remove(),p===e.user&&(p=null,u=null)})}else n.append('<div id="error"><h2>Please specify a channel in the URL, for example: <pre>https://[serveraddress]/[channel]/chat-box</pre></h2></div>')});